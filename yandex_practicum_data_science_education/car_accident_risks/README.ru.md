**RU** | [EN](README.md)

# Оценка рисков ДТП

- [Посмотреть Jupyter-блокнот](car_accident_risks_ru.ipynb)

Стэк: `catboost`, `lightgbm`, `sklearn`, `sql`, `sklearn`, `sqlalchemy`, `plotly`, `seaborn`, `matplotlib`, `pandas`, `numpy`

## Описание

- Заказчик каршеринговая компания
- Нужно оценить риск ДТП по выбранному маршруту движения
- Под риском понимается вероятность ДТП с любым повреждением транспортного средства
- Как только водитель забронировал автомобиль, сел за руль и выбрал маршрут, система должна оценить уровень риска
- Если уровень риска высок, водитель увидит предупреждение и рекомендации по маршруту
- Идея создания такой системы находится в стадии предварительного обсуждения и проработки. Чёткого алгоритма работы и подобных решений на рынке ещё не существует. Текущая задача — понять, возможно ли предсказывать ДТП, опираясь на исторические данные одного из регионов


- Провести статистический анализ факторов ДТП
  1. Выясните, в какие месяцы происходит наибольшее количество аварий. Проанализируйте весь период наблюдений (таблица `collisions`).
    - Постройте график
  2. Скоро состоится первое совещание вашей рабочей группы. Чтобы обсуждение было конструктивным, каждый сотрудник должен понимать данные. Для этого вы должны создать подходящие аналитические задачи и поручить их решение коллегам. Примеры задач:
    - Проведите анализ серьёзности повреждений транспортного средства, исходя из состояния дороги в момент ДТП (связать `collisions` и `parties`)
    - Найдите самые частые причины ДТП (таблица `parties`)
    1. Создайте не менее шести задач для коллег. Опирайтесь на примеры и таблицы
    2. Пропишите порядок решения для двух задач из списка. Обязательное условие — решение этих задач должно включать связь не менее 2-х таблиц


- Создать модель предсказания ДТП (целевое значение — `at_fault` (виновник) в таблице `parties`)
    - Для модели выбрать тип виновника — только машина (`car`).
    - Выбрать случаи, когда ДТП привело к любым повреждениям транспортного средства, кроме типа SCRATCH (царапина).
    - Для моделирования ограничиться данными за 2012 год — они самые свежие.
    - Обязательное условие — учесть фактор возраста автомобиля.
- На основе модели исследовать основные факторы ДТП.
- Понять, помогут ли результаты моделирования и анализ важности факторов ответить на вопросы:
  - Возможно ли создать адекватную системы оценки водительского риска при выдаче авто?
  - Какие ещё факторы нужно учесть?
  - Нужно ли оборудовать автомобиль какими-либо датчиками или камерой?


- Создать модель для оценки водительского риска
  1. Подготовьте набор данных на основе первичного предположения заказчика:
    - Выберите тип виновника — только машина (`car`)
    - Возьмите случаи, когда ДТП привело к любым значимым повреждениям автомобиля любого из участников — все, кроме типа SCRATCH (царапина).
    - Для моделирования возьмите данные только за 2012 год.
    - Подготовка исходной таблицы должна проводиться с помощью sql-запроса.
  2. Проведите первичный отбор факторов, необходимых для модели.
      Изучите описание факторов. Нужно отобрать те, которые могут влиять на вероятность ДТП. Будет хорошо, если вы аргументируете свой выбор. Пример:
      
      ```python
      columms =['party_type',     # Тип участника происшествия. Таблица parties
                'party_sobriety', # Уровень трезвости виновника (точно может влиять) Таблица parties
                ......
              ] 
      ```
  3. Проведите статистическое исследование отобранных факторов.
    - По результату исследовательского анализа внесите корректировки, если они нужны. Сделайте вывод.
    - Если необходимо, категоризируйте исходные данные, проведите масштабирование.
    - Подготовьте обучающую и тестовую выборки


- Найдите лучшую модель
  1. Смоделируйте не менее 3-х типов моделей с перебором гиперпараметров.
  2. 1–2 модели из спринта 2 (классическое обучение)
  3. 1–2 модели из спринта 3 (XGBoost, LightGBM, CatBoost)
  4. Выберите метрику для оценки модели, исходя из поставленной бизнесом задачи. Обоснуйте свой выбор.
  5. Оформите вывод в виде сравнительной таблицы.


- Проверьте лучшую модель в работе
  1. Проведите графический анализ «Матрица ошибок». Выведите полноту и точность на график.
  2. Проанализируйте важность основных факторов, влияющих на вероятность ДТП.
  3. Для одного из выявленных важных факторов проведите дополнительное исследование:
    - Покажите график зависимости фактора и целевой переменной.
    - Предложите, чем можно оборудовать автомобиль, чтобы учесть этот фактор во время посадки водителя.


## Выводы

- Основная часть данных есть с 2009.01.01 по 2012.06.01, а после этого периода их почти нет
- В среднем аварий примерно на 20000 больше в первые 5 месяцев года, чем в остальные месяца
- Больше всего аварий было в Октябре (начало заморозков)
- Меньше всего аварий было в Феврале


- Были поручены аналитические задачи коллегам для исследования данных


- Чем меньше количество участников тем больше дистанция
- 90% участников ДТП не пили
- 90% не использовали телефон
- Чуть меньше половины данных из Лос-Анджелес
- 20% ДТП случается на перекрёстке
- 80% случаев похода ясная
- 90% случаев повреждения маленький урон
- 95% причина ДТП это нарушение ПДД
- Больше всего ДТП случается с 2 участниками
- Топ 5 нарушений ПДД:
    - Speeding (Скорость)
    - Improper Turning (Неправильный поворот)
    - Automobile Right of Way (Автомобильное право проезда)
    - Unsafe Lane Change (Небезопасная смена полосы движения)
    - Pedestrian dui (Нарушение пешехода)
- Самый частый тип аварии, Rear End (Столкновение задней частью)
- 70% дополнительных участников ДТП, другой автомобиль
- 90% случаев дорога сухая
- 95% случаев дорога в нормальном состоянии
- 70% случаев происходит при дневном освещении
- 65% случаев нет устройства контроля, а тех у кого есть в 2 раза меньше


- Было использовано 4 модели для сравнения, лучшей оказалась `CatBoostClassifier` с метрикой **F1 0.742** на кросс-валидации и **F1 0.736** на тестовой выборке
- Самым важным фактором виновности в ДТП по версии этой модели это `primary_collision_factor` — основной фактор аварии. Водители которые соблюдают ПДД меньше становятся виновниками в ДТП
- Топ 6 самых важных факторов
    - `primary_collision_factor` — основной фактор аварии
    - `party_count` — количество участников
    - `party_sobriety` — трезовость участника
    - `pcf_violation_category` — категория нарушения
    - `motor_vehicle_involved_with` — дополнительные участники ДТП
    - `insurance_premium` — сумма страховки (тыс. $)
- "Основной фактор аварии" состоит в основном из "A — Code Violation (Нарушение правил ПДД)", по этому. **Предлагаю посредством приложения с несколькими заданиями тестировать водителя на знание правил ПДД. При успешном прохождении теста, допускать до вождения**
- Создание адекватной системы риска при выдаче авто вполне возможна, по предоставленным данным можно довольно значимо определить вероятность ДТП
- Помимо знания правил ПДД, учитывая другие важные факторы аварии, можно подумать о сборе таких дополнительных данных для возможного улучшения предсказания рисков:
    - Плотность движения и пробок для, возможно, построения маршрута где может находится наименьшее количество потенциальных участников ДТП
    - Сложность/особенности/топология дорог для выбора наименее рискованных